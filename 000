import { Component, inject } from '@angular/core';

import { Router } from '@angular/router';
import { LoginService } from '../login-service.service';
import * as CryptoJS from 'crypto-js';
@Component({
  selector: 'app-login',
  templateUrl: './login.component.html',
  styleUrl: './login.component.css'
})
export class LoginComponent {
  signupUser: any[] = [];
  
  loginObj: any = {
    email: '',
    password: '',
    role :''
  }
  router = inject(Router);
 
  constructor(private loginService: LoginService){
    sessionStorage.setItem('token', '')
  }
 
  onLogin() {
    const encryptedPassword=CryptoJS.AES.encrypt(this.loginObj.password,'secretCode@123').toString();
    const encryptedLoginObj = {
      email: this.loginObj.email,
      password:encryptedPassword
    };
    this.loginService.onLogin(encryptedLoginObj).subscribe({
      next: (response) => {
        //console.log('res:', response);
        sessionStorage.setItem('token', response.token)
        sessionStorage.setItem('customerID', response.id)

        this.loginObj.role = response.role;
        //console.log(sessionStorage.getItem('customerID'));

        if(this.loginObj.role == 1){
          this.router.navigateByUrl('customer-home')
        }
        else{
          this.router.navigateByUrl('admin-home')
        }
      },
      error: (err) => {
        console.error("Error: ", err);
      }      
    })
  }
}
